SUB MAIN()
    ' VERIFICA SE O DOCUMENTO ATUAL E UM DESENHO
    IF NOT TYPEOF THISDOC.DOCUMENT IS DRAWINGDOCUMENT THEN
        MSGBOX("O DOCUMENTO ATUAL NAO E UM DESENHO.", MSGBOXSTYLE.CRITICAL, "ERRO")
        EXIT SUB
    END IF

    DIM DWGDOC AS DRAWINGDOCUMENT = THISDOC.DOCUMENT

    ' OBTEM TODOS OS NOMES DAS FOLHAS
    DIM ALLSHEETNAMES AS NEW LIST(OFTSTRING)
    FOR EACH SHT AS SHEET IN DWGDOC.SHEETS
        ALLSHEETNAMES.ADD(SHT.NAME)
    NEXT

    ' ADICIONA AS OPCOES DE "EXCLUIR TODAS AS FOLHAS" E "INCLUIR TODAS AS FOLHAS" NO INICIO DA LISTA
    ALLSHEETNAMES.INSERT(0, "EXCLUIR TODAS AS FOLHAS PARA IMPRESSAO")
    ALLSHEETNAMES.INSERT(1, "INCLUIR TODAS AS FOLHAS PARA IMPRESSAO")

    ' CHAMA A FUNCAO DE SELECAO MULTIPLA PARA AS FOLHAS
    DIM SELECTEDSHEETS AS LIST(OFTSTRING) = MULTISELECTLISTBOX("SELECIONE AS FOLHAS OU OPCOES", ALLSHEETNAMES, NOTHING, "SELECAO DE FOLHAS", "FOLHAS DISPONIVEIS")

    ' VERIFICA SE O USUARIO SELECIONOU ALGO
    IF SELECTEDSHEETS IS NOTHING ORELSE SELECTEDSHEETS.COUNT = 0 THEN
        MSGBOX("NENHUMA FOLHA FOI SELECIONADA.", MSGBOXSTYLE.EXCLAMATION, "NENHUMA SELECAO")
        EXIT SUB
    END IF

    ' PROCESSA AS OPCOES SELECIONADAS
    FOR EACH SHEETNAME AS STRING IN SELECTEDSHEETS
        IF SHEETNAME = "EXCLUIR TODAS AS FOLHAS PARA IMPRESSAO" THEN
            EXCLUIRFOLHASDAIMPRESSAO()
        ELSEIF SHEETNAME = "INCLUIR TODAS AS FOLHAS PARA IMPRESSAO" THEN
            INCLUIRFOLHASNAIMPRESSAO()
        ELSE
            ' ATIVA A FOLHA SELECIONADA PARA IMPRESSAO
            ATIVARFOLHAPARAIMPRESSAO(SHEETNAME)
        END IF
    NEXT

    ' EXIBIR MENSAGEM DE SUCESSO
    MSGBOX("AS FOLHAS SELECIONADAS FORAM PROCESSADAS.", MSGBOXSTYLE.INFORMATION, "PROCESSO CONCLUIDO")
END SUB

' ===========================================
' FUNCAO PARA CRIAR UMA CAIXA DE SELECAO MULTIPLA
FUNCTION MULTISELECTLISTBOX(OPTIONAL INSTRUCTIONS AS STRING = VBNULSTRING, _
OPTIONAL ITEMS AS IENUMERABLE = NOTHING, OPTIONAL DEFAULTVALUE AS OBJECT = NOTHING, _
OPTIONAL TITLE AS STRING = NOTHING, OPTIONAL LISTNAME AS STRING = NOTHING) AS LIST(OFTSTRING)
    USING OILBD AS NEW INPUTLISTBOXDIALOG(TITLE, LISTNAME, INSTRUCTIONS, ITEMS, DEFAULTVALUE)
        DIM OLB AS SYSTEM.WINDOWS.FORMS.LISTBOX = OILBD.CONTROLS.ITEM(0).CONTROLS.ITEM(2)
        OLB.SELECTIONMODE = SYSTEM.WINDOWS.FORMS.SELECTIONMODE.MULTISIMPLE
        DIM ODLGRESULT AS SYSTEM.WINDOWS.FORMS.DIALOGRESULT = OILBD.SHOWDIALOG()

        ' OBTENHA OS ITENS SELECIONADOS DIRETAMENTE
        DIM SELECTEDITEMS AS NEW LIST(OFTSTRING)
        FOR EACH ITEM IN OLB.SELECTEDITEMS
            SELECTEDITEMS.ADD(ITEM.TOSTRING())
        NEXT

        ' RETORNA A LISTA DE ITENS SELECIONADOS
        IF SELECTEDITEMS.COUNT > 0 THEN
            RETURN SELECTEDITEMS
        ELSE
            RETURN NOTHING
        END IF
    END USING
END FUNCTION

' FUNCAO PARA ATIVAR UMA FOLHA PARA IMPRESSAO
SUB ATIVARFOLHAPARAIMPRESSAO(SHEETNAME AS STRING)
    ' RECEBE O DOCUMENTO DE DESENHO ATIVO
    DIM DWGDOC AS DRAWINGDOCUMENT = THISDOC.DOCUMENT

    ' PROCURA PELA FOLHA PELO NOME
    FOR EACH DRAWSHEET AS SHEET IN DWGDOC.SHEETS
        IF DRAWSHEET.NAME = SHEETNAME THEN
            ' ATIVA A FOLHA PARA IMPRESSAO
            DRAWSHEET.EXCLUDEFROMPRINTING = FALSE
            EXIT FOR
        END IF
    NEXT
END SUB

' FUNCAO PARA EXCLUIR TODAS AS FOLHAS DA IMPRESSAO
SUB EXCLUIRFOLHASDAIMPRESSAO()
    ' RECEBE O DOCUMENTO DE DESENHO ATIVO
    DIM DWGDOC AS DRAWINGDOCUMENT = THISDOC.DOCUMENT

    ' ITERA ATRAVES DAS FOLHAS DO DESENHO E AS EXCLUI DA IMPRESSAO
    FOR EACH DRAWSHEET AS SHEET IN DWGDOC.SHEETS
        DRAWSHEET.EXCLUDEFROMPRINTING = TRUE
    NEXT

    MSGBOX("TODAS AS FOLHAS FORAM EXCLUIDAS DA IMPRESSAO.", MSGBOXSTYLE.INFORMATION, "FOLHAS EXCLU√çDAS")
END SUB

' FUNCAO PARA INCLUIR TODAS AS FOLHAS PARA IMPRESSAO
SUB INCLUIRFOLHASNAIMPRESSAO()
    ' RECEBE O DOCUMENTO DE DESENHO ATIVO
    DIM DWGDOC AS DRAWINGDOCUMENT = THISDOC.DOCUMENT

    ' ITERA ATRAVES DAS FOLHAS DO DESENHO E AS INCLUI NA IMPRESSAO
    FOR EACH DRAWSHEET AS SHEET IN DWGDOC.SHEETS
        DRAWSHEET.EXCLUDEFROMPRINTING = FALSE
    NEXT

    MSGBOX("TODAS AS FOLHAS FORAM INCLUIDAS PARA IMPRESSAO.", MSGBOXSTYLE.INFORMATION, "FOLHAS INCLUIDAS")
END SUB
